<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farm Activity Experiment</title>

  <!-- jsPsych Core Library -->
  <script src="https://unpkg.com/jspsych@8.2.1"></script>
  <link href="https://unpkg.com/jspsych@8.2.1/css/jspsych.css" rel="stylesheet">

  <!-- Plugins -->
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.0.0"></script>
  <script src="https://unpkg.com/jspsych-pipe@1.0.0"></script>

</head>
<body>

<script>
  // Randomly assign participants to one of four conditions
  const conditions = ["text-only", "drag", "imagine", "gesture"];
  const assignedCondition = jsPsych.randomization.sampleWithoutReplacement(conditions, 1)[0];

  // Condition-specific instructions
  const instructionTexts = {
    "text-only": "Please read the following text carefully.",
    "drag": "Read the text, then drag the animals and objects accordingly.",
    "imagine": "Read the text and imagine the characters moving as described.",
    "gesture": "Read the text and gesture the animals moving according to the text."
  };

  // Instruction trial
  const instructions = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `<p>${instructionTexts[assignedCondition]}</p>`,
    choices: ["Continue"]
  };

  // Text-only activity
  const textOnlyActivity = {
    type: jsPsychHtmlButtonResponse,
    stimulus: `
      <p>I need to get some work done around the farm.</p>
      <p>First, I gather the hay and take it to the cow.</p>
      <p>Next, I collect eggs from the chicken coop and place them in the nearby basket.</p>
      <p>Then, one by one, I gather the pumpkins from the field and bring them to the pigs.</p>
      <p>The pigs are hungry, so they run to the pumpkins and begin to munch right away.</p>
      <p>Finally, I grab the watering can from the barn and water the garden so the vegetables can grow.</p>
      <p>All the animals are fed, and the farm is taken care of.</p>`,
    choices: ["Continue"]
  };

  // Redirect to external drag-and-drop farm activity page
  const dragActivity = {
    type: jsPsychHtmlButtonResponse,
    stimulus: "<p>You will now complete an interactive farm activity.</p>",
    choices: ["Start Activity"],
    on_finish: function() {
      window.location.href = "Activity.html"; // Updated to "Activity.html"
    }
  };

  // Free-response question
  const freeResponseQuestion = {
    type: jsPsychSurveyText,
    questions: [
      { prompt: "Please describe your experience with the farm activity.", rows: 5, columns: 50 }
    ]
  };

  // Save data to jsPsychPipe
  const filename = `farm_activity_${jsPsych.randomization.randomID(10)}.csv`;
  const save_data = { 
    type: jsPsychPipe,
    action: "save",
    experiment_id: "vMOMMZm8ucfh",  // Replace with your jsPsychPipe experiment ID
    filename: filename,
    data_string: () => jsPsych.data.get().csv()
  };

  // Timeline logic based on condition
  let timeline = [instructions];

  if (assignedCondition === "text-only") {
    timeline.push(textOnlyActivity);
  } else {
    timeline.push(dragActivity);
  }

  timeline.push(freeResponseQuestion, save_data);

  // Initialize jsPsych
  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      jsPsych.data.displayData(); // Show data after completion (optional)
    }
  });

</script>

</body>
</html>
